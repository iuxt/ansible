# Linux Mint 20
- include: fcitx-rime.yml
  when: 
    - ansible_distribution == "Linux Mint"
    - ansible_distribution_major_version|int == 20

# Linux Mint 21
- include: fcitx-rime.yml
  when: 
    - ansible_distribution == "Linux Mint"
    - ansible_distribution_major_version|int == 21

# Debian
- include: fcitx5-rime.yml
  when: ansible_distribution == "Debian"

# Ubuntu 桌面版
- include: ibus-rime.yml
  when: 
    - ansible_distribution == "Ubuntu"
    - "'WSL2' not in ansible_kernel"

# WSL2
- include: fcitx5-rime.yml
  when: "'WSL2' in ansible_kernel"


- name: 创建.zprofile文件
  file:
    path: "~/.zprofile"
    state: touch
    modification_time: preserve
    access_time: preserve


# 兼容wsl2启动输入法
- name: 兼容wsl2启动输入法
  blockinfile:
    block: |
      export GTK_IM_MODULE=fcitx
      export QT_IM_MODULE=fcitx
      export XMODIFIERS=@im=fcitx
      export SDL_IM_MODULE=fcitx
      export GLFW_IM_MODULE=ibus
      fcitx5 --disable=wayland -d  --verbose '*'=0
    marker: "# {mark} rime autostart on wsl2 by ansible"
    path: ~/.zprofile
  become: no
  when: "'WSL2' in ansible_kernel"

# - name: create wayland environment
#   blockinfile:
#     block: |
#       INPUT_METHOD=fcitx
#       GTK_IM_MODULE=fcitx
#       QT_IM_MODULE=fcitx
#       XMODIFIERS=@im=fcitx
#     marker: "# {mark} fcitx auto start manage by ansible"
#     path: /etc/environment
#   become: yes
#   when: ansible_env.XDG_SESSION_TYPE == "wayland"
